/*! bezierizer - v0.0.1 - 2013-09-16 - https://github.com/jeremyckahn/bezierizer */
(function(t){function e(t,e){return parseInt(e.css("left"),10)/(t.outerWidth(!0)-e.outerWidth(!0))}function i(t,e){return parseInt(e.css("top"),10)/(t.outerHeight(!0)-e.outerHeight(!0))}function n(e){this.$el=t(e),this.$el.append(t(s)),this._$canvasContainer=this.$el.find(".bezierizer-canvas-container"),this._$canvas=this._$canvasContainer.find("canvas"),this._$handleContainer=this.$el.find(".bezierizer-handle-container"),this._$handles=this._$handleContainer.find(".bezierizer-handle"),this._ctx=this._$canvas[0].getContext("2d"),this._$canvas[0].height=this._$canvas.height(),this._$canvas[0].width=this._$canvas.width(),this._$handles.dragon({within:this._$handleContainer}),this._points={},this.setHandlePositions({x1:.25,y1:.5,x2:.75,y2:.5}),this._initBindings()}var s=['<div class="bezierizer-container">','<div class="bezierizer-canvas-container">',"<canvas></canvas>",'<div class="bezierizer-handle-container">','<button class="bezierizer-handle bezierizer-handle-1">','<button class="bezierizer-handle bezierizer-handle-2">',"</div>","</div>","</div>"].join("");window.Bezierizer=n,n.prototype._initBindings=function(){this._$canvasContainer.on("drag",".bezierizer-handle",t.proxy(function(){this._updateInternalStateFromDOM(),this._redraw(),this.$el.trigger("change")},this))},n.prototype._updateInternalStateFromDOM=function(){var t=this._$handleContainer;this._points={x1:e(t,this._$handles.eq(0)),y1:i(t,this._$handles.eq(0)),x2:e(t,this._$handles.eq(1)),y2:i(t,this._$handles.eq(1))}},n.prototype._redraw=function(){var t=this._points,e=this._$canvas[0].height,i=this._$canvas[0].width,n=t.x1*i,s=t.y1*e,a=t.x2*i,h=t.y2*e,o=this._ctx,r="#888",d=2;o.clearRect(0,0,i,e),o.beginPath(),o.lineWidth=d,o.moveTo(n,s),o.lineTo(0,0),o.strokeStyle=r,o.stroke(),o.closePath(),o.beginPath(),o.lineWidth=4,o.moveTo(0,0),o.bezierCurveTo(n,s,a,h,i,e),o.strokeStyle="#ccc",o.stroke(),o.closePath(),o.beginPath(),o.lineWidth=d,o.moveTo(i,e),o.lineTo(a,h),o.strokeStyle=r,o.stroke(),o.closePath()},n.prototype.getHandlePositions=function(){return t.extend({},this._points)},n.prototype.setHandlePositions=function(e){t.extend(this._points,e);var i=this._$handleContainer.outerHeight(!0),n=this._$handleContainer.outerWidth(!0),s=this._$handles.outerWidth(!0),a=this._$handles.outerHeight(!0);this._$handles.eq(0).css({left:Math.floor(this._points.x1*(n-s))+1,top:Math.floor(this._points.y1*(i-a))+1}),this._$handles.eq(1).css({left:Math.floor(this._points.x2*(n-s))+1,top:Math.floor(this._points.y2*(i-a))+1}),this._redraw()}})(jQuery);